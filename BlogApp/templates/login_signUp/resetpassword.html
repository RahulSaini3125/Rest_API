{% extends 'base/base.html' %}
{% load static %}


{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="row justify-content-center">
                <div class="col-lg-8 mt-5">
                    <h2 class="mb-4">Forget Password</h2>
                    <!-- <form id="contact-form" action="" method="post" class="contact-form"> -->
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="name">Enter Your Email</label>
                                    <input class="form-control form-control-name" id="Current_email" type="email" name="email" required placeholder="Enter Your email">
                                </div>
                                <input class="btn btn-primary solid blank mt-3" type="submit" onclick="submit_verify_email()" name="sendmail" value="Send OTP">
                            </div>
                        </div>
                        <div class="form-group" id="verify_otp">
                            <label for="Change_email_otp1">Enter OTP</label>
                            <input type="number" class="form-control form-control-name"
                                id="change_email_otp" name="Change_email_otp1" placeholder="Enter Your OTP">
                                <input class="btn btn-primary solid blank mt-3" type="button" name="otp_verify"
                                value="Change Password" onclick="Verfiy_otp_btn()">
                            </div> 
                    <!-- </form> -->
                </div>
            </div>
        </div>
    </div>
</div>


{% endblock content %}


{% block scriptblock %}
<script>
     $('#verify_otp').css('display','none')
    function submit_verify_email(){
        var email = document.getElementById('Current_email')
        if (email.value == '') {
            showNotification('Please Enter Email ID',false)
        }
        else{
            $.ajax({
                type: 'POST',
                url: '/api/check_email_password/', // Update this URL with your Django API endpoint
                data: {'email': email.value},
                success: function(response) {
                    if (response.available) {
                        email.disabled = true
                        $('#verify_otp').css('display','block')
                        $('#submit_new_email').css('display','none')
                        showNotification('OTP Send to Your Email',true)
                    } else {
                        showNotification('Email is Already Registor',false)
                    }
                },
                error: function(xhr, status, error) {
                    showNotification(error,false)
                }
            })
        }
        }
    </script>


<script>
    function Verfiy_otp_btn() {
        var otp = $('#change_email_otp').val();  // Get the OTP value from the input field
        var newEmail = $('#Current_email').val();  // Get the new email value from the input field
        if (otp == '') {
            showNotification('Please Enter OTP',false)
        }
        else{
            $.ajax({
                type: 'POST',
                url: '/api/VerifyOTP/', 
                data: { 'otp': otp, 'new_email': newEmail },
                success: function(response) {
                    localStorage.setItem('new_email',response.message)
                    window.location.href = '/ForgetPassword/'
                },
                error: function(xhr, status, error) {
                    if (xhr.responseJSON.error) {
                        showNotification(xhr.responseJSON.error,false)  // Show error message
                    }
                    else{
                        showNotification('Something Went Wrong',false)
                    }
                }
            });
        }
    }
</script>

    {% endblock %}